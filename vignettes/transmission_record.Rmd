---
title: "The Transmission Record"
author: "Bob Verity"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{The Transmission Record}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<!---
Example comment
-->

In the second step of the SIMPLEGEN pipeline the output of our transmission model is stored in a file called the *transmission record*. This vignette describes the format of the transmission record, and explains the logic behind storing information in this way.

### What information do we need to track?

When we simulate from a transmission model there are typically many thousands or even millions of events that take place. Some of these events have the *potential* to impact the genotypes that we see in our final sample of infected people - this does not mean they definitely *will* impact the observed genotypes, just that that *could* in theory impact them. A good example is a host being bitten by two infectious mosquitoes; this could result in a polyclonal infection if the mosquitoes carry different genotypes, or it could result in a monoclonal infection if the mosquitoes carry the same genotype.

On the other hand, there are many events that cannot impact the genotypes we see in our final sample. A good example is a human host dying, either as a result of infection or just old age. If a host dies then by definition it will not make it into our final sample of malaria-positive people, and so tracking this event would be a waste of time and computer memory.

Overall, the purpose of the transmission record is **to keep a record of all events that have the potential to impact the genotypes in the final sample**. This will allow us to use the transmission record to generate genotypes outside of the main simulation. A secondary aim is to do this **in a computationally efficient way**, retaining only the minimum information required. Simulations can get quite intensive, and so aiming for efficiency at this early stage can help keep file sizes small. Finally, we aim to do this **in a flexible way**, thereby ensuring that as many models as possible can access the pipeline.

These three aims are slightly at odds with one another, and there is no single file format that will achieve all three perfectly. In the following we have tried to strike a balance that permits reasonably complex models while still keeping file sizes quite small.


### Tracking infections, not genotypes

The transmission record works with *infections*, defined in this context as **a population of parasites passed between human host and mosquito at the point of biting**. Thus, a single infection can contain multiple genotypes or a single genotype. When we track infections we are simply making a note that a particular person had the potential to receive parasites from a particular mosquito, or vice versa. We are not thinking about more complex things like genetic drift or recombination which will be dealt with later.

We can now specify one of the most important assumptions of the SIMPLEGEN pipeline:

**We assume that the genotypes within an infection have no direct impact on disease progression or onward transmissibility.**

This is a tricky statement to unpack, and actually allows for quite a wide range of models. In the simplest case we can think of genotypes separated by neutral mutations, i.e. those that confer no selective advantage to the parasite. In this case the frequencies of the different genotypes will drift up and down over time, perhaps undergoing strong bottlenecking at times, but crucially the relative frequencies will have no bearing on the overall progression of disease (otherwise they would not be neutral mutations). There can be a lot of information in patterns of neutral mutation, and so generating this sort of data will be one of the main use-cases of SIMPLEGEN.

We can also think of examples that violate this assumption. We can imagine a model in which a particular genotype confers resistance to a common antimalarial drug, increasing the chance that an infection persists even after treatment. Here the presence or absence of the drug resistant gene directly impacts the progression of the disease, and so we would need to know genotypes at the time of simulating. This example would therefore not fit well within our framework.

Not all models and research questions will fit neatly within this framework, but many transmission models use something akin to infections internally and so hopefully can be modified to produce output that can be used by SIMPLEGEN.


### Working with infection IDs



Figure 1 gives an example of an infection being passed from a human host to a mosquito. There are several different IDs here: the human has <span style="color: red;"><b>ID 21</b></span>, the mosquito has <span style="color: blue;"><b>ID 33</b></span>, and the infection IDs are shown inside the small circles. The human initially carries infection ID 1, which then becomes infection ID 2 when it is passed to the mosquito. We can say that infection ID 1 is the parent of infection ID 2.

<img src="https://raw.githubusercontent.com/mrc-ide/SIMPLEGEN/develop/R_ignore/images/transmission_record_single.png" width="100" height = "100"/>
<font size="2">
<figcaption> **Figure 1** Example of a human passing infection to a mosquito.</figcaption>
</font>


<img src="https://raw.githubusercontent.com/mrc-ide/SIMPLEGEN/develop/R_ignore/images/transmission_record.png" width="100" height = "200"/>
<font size="2">
<figcaption> **Figure 1** Transmission record diagram.</figcaption>
</font>

Text

<img src="https://raw.githubusercontent.com/mrc-ide/SIMPLEGEN/develop/R_ignore/images/transmission_record_table.png" width="100" height = "200"/>
<font size="2">
<figcaption> **Figure 1** Transmission record diagram.</figcaption>
</font>

Text






