<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparing model output to data â€¢ SIMPLEGEN</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparing model output to data">
<meta property="og:description" content="SIMPLEGEN">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SIMPLEGEN</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li>
      <a href="../articles/basic_tutorial.html">Basic Tutorial</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/model_description.html">Transmission Model Details</a>
    </li>
    <li>
      <a href="../articles/transmission_record.html">The Transmission Record</a>
    </li>
    <li>
      <a href="../articles/simulating_relatedness.html">Simulating Relatedness</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/SIMPLEGEN">
    <span class="fas fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="comparing_to_data_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparing model output to data</h1>
                        <h4 class="author">Isobel Routledge</h4>
            
            <h4 class="date">2021-01-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/SIMPLEGEN/blob/master/vignettes/comparing_to_data.Rmd"><code>vignettes/comparing_to_data.Rmd</code></a></small>
      <div class="hidden name"><code>comparing_to_data.Rmd</code></div>

    </div>

    
    
<p>It is often helpful to check model outputs are consistent with emprirical data and sensible. In this package we provide several datasets and examples of SIMPLEGEN model outputs compared to data to check that key epidemiological relationships are represented consistent with empirical data and data generated from other models.</p>
<div id="comparing-annual-eir-to-parasite-prevalence" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-annual-eir-to-parasite-prevalence" class="anchor"></a>Comparing annual EIR to parasite prevalence</h2>
<p>In order to compare annual EIR to parasite prevalence , we must generate annual EIR estimates, true prevalence estimates and the expected detected prevalence at a given sampling time. In this example use an expectation for detectibility based on the sum of the probability of detection accross all individuals, but future iterations of the function could be altered to generate the estimated prevalence and bootstrapped confidence intervals by carrying out bernoulli draws based on the mean detectability.</p>
<p>First we run SIMPLEGEN for a range of EIRs by changing the mosquito population size:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># vector of mosquito population sizes</span>
<span class="va">m_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1e3</span>, <span class="fl">9e3</span>, <span class="fl">1e3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1e4</span>, <span class="fl">9e4</span>, <span class="fl">1e4</span><span class="op">)</span>, <span class="fl">1e5</span>, <span class="fl">2e5</span><span class="op">)</span>
<span class="va">m_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1e4</span>, <span class="fl">1e5</span><span class="op">)</span>

<span class="co"># run simulation and store results</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">list_proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">m_pop</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">myproj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simplegen_project.html">simplegen_project</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/define_epi_params.html">define_epi_params</a></span><span class="op">(</span>seed_infections <span class="op">=</span> <span class="fl">100</span>,
                      H <span class="op">=</span> <span class="fl">1e3</span>,
                      M <span class="op">=</span> <span class="va">m_pop</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
                      detectability_microscopy_chronic <span class="op">=</span> <span class="fl">0.45</span>,
                      detectability_PCR_chronic <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/sim_epi.html">sim_epi</a></span><span class="op">(</span>max_time <span class="op">=</span> <span class="fl">365</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span>
  <span class="va">dat</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">myproj</span><span class="op">$</span><span class="va">epi_output</span><span class="op">$</span><span class="va">daily_values</span>
  <span class="va">list_proj</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">myproj</span>
<span class="op">}</span></code></pre></div>
<p>Then we use the inbuilt function retrieve_prev to retrieve the true prevalence and estimated detected prevalence from the simulation. We estimate prevalence on a given sampling day and define the type of diagnostic used (PCR or microscopy) and case detection (active or passive).</p>
<p>Expected prevalence is calculated by using the sum of the indidvidual probabilities of detection on a given day (A_detectable_microscopy, C_detectable_microscopy,A_detectable_PCR,C_detectable_PCR), divided by the human population size. For example, if there are 100 cases and P(detection by PCR) for all acute and chronic cases = 0.9,and H=1000, then true prevalence = 100/1000 = 0.1, and expected detected prevalence by PCR is 0.9*100/1000 = 0.09.</p>
<p>We then apply this to the different simulated datasets to create a table of annual EIR and prevalence estimates.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">EIRprev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">dat</span>, FUN <span class="op">=</span> <span class="va">retrieve_prev</span>,
                    case_detection <span class="op">=</span> <span class="st">"Active"</span>, diagnosis <span class="op">=</span> <span class="st">"Microscopy"</span>,
                    sampling_time <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">EIRprev</span><span class="op">)</span></code></pre></div>
<pre><code>FALSE      annual_EIR prevalence_true prevalence_detected
FALSE [1,]    11.0505           0.494             0.25365
FALSE [2,]   167.0094           0.857             0.50005</code></pre>
<p>Then we can plot on a linear scale using the inbuilt plot_EIR_prevalence function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_EIR_prevalence.html">plot_EIR_prevalence</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">EIRprev</span>,scale_x <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></code></pre></div>
<p><img src="comparing_to_data_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>Next we can plot on a log scale:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_EIR_prevalence.html">plot_EIR_prevalence</a></span><span class="op">(</span><span class="va">EIRprev</span>,scale_x <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span></code></pre></div>
<p><img src="comparing_to_data_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bob Verity, Sophie Berube, Daniel Larremore.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
