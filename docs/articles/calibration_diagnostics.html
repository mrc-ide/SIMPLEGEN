<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calibration to data on diagnostic sensitivity • SIMPLEGEN</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Calibration to data on diagnostic sensitivity">
<meta property="og:description" content="SIMPLEGEN">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SIMPLEGEN</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Get started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Simulating malaria transmission</li>
    <li>
      <a href="../404.html">A simple model</a>
    </li>
    <li>
      <a href="../404.html">Population surveys</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Overlaying genetics</li>
    <li>
      <a href="../404.html">Pruning the transmission record</a>
    </li>
    <li>
      <a href="../404.html">Pedigrees and relatedness</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    The models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Detailed descriptions</li>
    <li>
      <a href="../articles/model_description.html">The inbuilt transmission model</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Model calibration</li>
    <li>
      <a href="../articles/calibration_approach.html">Overall approach</a>
    </li>
    <li>
      <a href="../articles/calibration_prev_inc.html">Prevalence, incidence and EIR</a>
    </li>
    <li>
      <a href="../articles/calibration_diagnostics.html">Diagnostic sensitivity</a>
    </li>
    <li>
      <a href="../articles/calibration_age_inc.html">Age-incidence</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    The data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Epidemiological data</li>
    <li>
      <a href="../articles/data_prev_inc.html">Prevalence, incidence and EIR</a>
    </li>
    <li>
      <a href="../articles/data_diagnostics.html">Diagnostic sensitivity</a>
    </li>
    <li>
      <a href="../articles/data_age_inc.html">Age-incidence</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Genetic data</li>
    <li>
      <a href="../404.html">Complexity of infection</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/SLiM_review.html">Integrating with SLiM</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/SIMPLEGEN" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Calibration to data on diagnostic
sensitivity</h1>
                        <h4 data-toc-skip class="author">Bob Verity</h4>
            
            <h4 data-toc-skip class="date">2023-03-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/SIMPLEGEN/blob/HEAD/vignettes/calibration_diagnostics.Rmd" class="external-link"><code>vignettes/calibration_diagnostics.Rmd</code></a></small>
      <div class="hidden name"><code>calibration_diagnostics.Rmd</code></div>

    </div>

    
    
<!---
Set the font size of figure captions
Currently not used because figures inserted with html method
-->
<style>
p.caption {
  font-size: 0.9em;
}
</style>
<p>This report aims to:</p>
<ul>
<li>Explore the sensitivity to detect malaria by microscopy, rapid
diagnostic test (RDT) and polymerase chain reaction (PCR)</li>
<li>Compare model fits against datasets obtained from the
literature.</li>
<li>Gain insights to help with future model development.</li>
</ul>
<div class="section level3">
<h3 id="prevalence-by-microscopy-vs--pcr">Prevalence by microscopy vs. PCR<a class="anchor" aria-label="anchor" href="#prevalence-by-microscopy-vs--pcr"></a>
</h3>
<p>The data used here come from a systematic review by <a href="https://doi.org/10.1016/S2666-5247(21)00055-0" class="external-link">Whittaker et
al. (2021)</a> looking into global patterns of submicroscopic <em>P.
falciparum</em> infection - see <a href="www.TODO">here</a> for further
information on this dataset. Let’s start by plotting the raw data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot data and model</span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="va">PCR_micro_age_whittaker2021</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">PCR_Prev</span>, y <span class="op">=</span> <span class="va">Micro_Prev</span>, color <span class="op">=</span> <span class="va">Age_Group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="../reference/simplegen_cols.html">simplegen_cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Prevalence (PCR)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Prevalence (microscopy)"</span><span class="op">)</span></span>
<span><span class="va">plot1</span></span></code></pre></div>
<p><img src="calibration_diagnostics_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>We can see that prevalence by microscopy is always below the 1:1
line, in other words, microscopy is less sensitive than PCR over the
entire prevalence range. The relationship also appears to have a curve,
with the two measures agreeing at both very high and very low
prevalence, but with microscopy being significantly below PCR prevalence
at intermediate values. Nevertheless, let’s start by fitting a simple
linear relationship to each age group to get a feel for the overall
slope:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit linear model to each age group</span></span>
<span><span class="va">slope_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Micro_Prev</span> <span class="op">~</span> <span class="va">x</span><span class="op">$</span><span class="va">PCR_Prev</span> <span class="op">+</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Age_Group <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">Age_Group</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, slope <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">PCR_micro_age_whittaker2021</span>, f <span class="op">=</span> <span class="va">PCR_micro_age_whittaker2021</span><span class="op">$</span><span class="va">Age_Group</span><span class="op">)</span>, SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">bind_rows</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add fits to plot</span></span>
<span><span class="va">plot2</span> <span class="op">&lt;-</span> <span class="va">plot1</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>slope <span class="op">=</span> <span class="va">slope</span>, intercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="va">Age_Group</span><span class="op">)</span>,</span>
<span>              linetype <span class="op">=</span> <span class="st">"dashed"</span>, data <span class="op">=</span> <span class="va">slope_df</span><span class="op">)</span></span>
<span><span class="va">plot2</span></span></code></pre></div>
<p><img src="calibration_diagnostics_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print slope</span></span>
<span><span class="va">slope_df</span></span></code></pre></div>
<pre><code><span><span class="co">##                Age_Group     slope</span></span>
<span><span class="co">## x$PCR_Prev...1       0-5 0.7352078</span></span>
<span><span class="co">## x$PCR_Prev...2 5-15years 0.6177060</span></span>
<span><span class="co">## x$PCR_Prev...3       15+ 0.4601922</span></span></code></pre>
<p>This is not an excellent fit to the data, but it makes it clear that
microscopy sensitivity decreases (relative to PCR) as we look at older
age groups.</p>
<p>We will compare this against model output produced by taking a range
of mosquito relative population densities, implying a range of EIRs.
Measured values include the prevalence by both microscopy and PCR in age
groups that correspond to the data (0-5 years, 5-15 years, and over 15
year olds). For each simulation, model output is run for 20 years and
prevalences are taken as the average over the final 10 years.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load precomputed model output</span></span>
<span><span class="co"># code to produce this output: R_ignore/calibration/calibration_micro_PCR1.R</span></span>
<span><span class="va">df_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"../inst/extdata/calibration_micro_PCR1.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot2</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">PCR</span>, y <span class="op">=</span> <span class="va">Micro</span>, color <span class="op">=</span> <span class="va">Age_Group</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df_model</span><span class="op">)</span></span></code></pre></div>
<p><img src="calibration_diagnostics_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>We can see that our model captures the overall pattern in the data,
but it fails to capture the differences between the age groups. This
implies that we need a stronger relationship between detectibility and
age in our model, such that older age groups contain many
sub-microscopic infections. As we only model detectibility changing as a
function of exposure and not age, we need this to be an exposure-driven
effect in the current setup. However, any changes also need to make
sense in terms of age-incidence patterns (see <a href="www.TODO">here</a>).</p>
<p>We also find that the model is too linear, having a slight upwards
curve at very high prevalence but nothing like what we see in the data.
At extremely high transmission it is likely that the vast majority of
infections are asymptomatic, but based on the patterns above we would
also expect them to be microscopy-positive, rather than purely
sub-patent. Hence, we perhaps need to revisit the implied connection
between clinical status and detectibility in our model.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bob Verity, Shazia Ruybal, Isobel Routledge, Sophie Berube, Daniel Larremore.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
